{% extends 'base.html' %}
{% load static i18n %}
{% load currency_filters digit_filters %}

{% block title %}{% trans "Analytics" %} - TrackMyRupee{% endblock %}

{% block content %}
{% if not is_locked %}
<div class="row mb-4 animate__animated animate__fadeIn">
    <div class="col-12 d-flex justify-content-between align-items-center">
        <div>
            <h1 class="h3 fw-bold mb-1">{% trans "Analytics & Trends" %}</h1>
            <p class="text-muted mb-0">{% trans "Visualizing your financial journey over the last 12 months." %}</p>
        </div>
        <div class="d-none d-md-block">
            <form method="get" class="d-inline-block">
                <div class="input-group input-group-sm shadow-sm" style="width: 130px;">
                    <span class="input-group-text bg-white border-end-0 text-primary"><i class="bi bi-calendar3"></i></span>
                    <select name="year" class="form-select border-start-0 ps-0 fw-bold" onchange="this.form.submit()" style="cursor: pointer;">
                        {% for yr in available_years %}
                            <option value="{{ yr }}" {% if yr == selected_year %}selected{% endif %}>{{ yr }}</option>
                        {% endfor %}
                    </select>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Financial Health Score Section -->
<div class="row mb-4 animate__animated animate__fadeInUp">
    <div class="col-12">
        <div class="card border-0 shadow-sm bg-{{ health_color }} bg-opacity-10">
            <div class="card-body p-4">
                <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
                    <div class="d-flex align-items-center">
                        <div class="icon-shape icon-shape-md bg-white text-{{ health_color }} rounded-circle me-3 shadow-sm" style="width: 60px; height: 60px; display: flex; align-items: center; justify-content: center;">
                            <i class="bi bi-heart-pulse-fill fs-3"></i>
                        </div>
                        <div>
                            <h5 class="fw-bold mb-1">{% trans "Financial Health Score" %}</h5>
                            <div class="d-flex align-items-center gap-2">
                                <h2 class="mb-0 fw-bold text-{{ health_color }}">{{ health_score }}/100</h2>
                                <span class="badge bg-white text-{{ health_color }} border border-{{ health_color }} rounded-pill px-3">{{ health_label }}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex-grow-1 ms-md-4 border-start border-{{ health_color }} border-opacity-25 ps-md-4" style="max-width: 700px;">
                        <h6 class="fw-bold text-{{ health_color }} mb-2"><i class="bi bi-magic me-1"></i> {% trans "AI Insights" %}</h6>
                        {% if insights %}
                            {% for insight in insights %}
                            <div class="d-flex align-items-start mb-2">
                                <i class="bi bi-check-circle-fill text-{{ health_color }} me-2 mt-1 small"></i>
                                <p class="mb-0 text-muted small fw-medium">{{ insight }}</p>
                            </div>
                            {% endfor %}
                        {% else %}
                             <p class="mb-0 text-muted small">{% trans "Track more expenses to generate AI insights." %}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Key Metrics Row -->
<div class="row g-4 mb-4 animate__animated animate__fadeInUp">
    <div class="col-md-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="icon-shape icon-shape-sm bg-success bg-opacity-10 text-success rounded-circle me-3">
                        <i class="bi bi-graph-up-arrow fs-5"></i>
                    </div>
                    <div>
                        <h6 class="text-muted mb-0">{% trans "Total Income" %} {% if is_current_year %}(YTD){% endif %}</h6>
                    </div>
                </div>
                <h3 class="fw-bold mb-0">
                    {{ user.profile.currency }}{{ total_income_ytd|floatformat:0|translate_digits }}
                </h3>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
         <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="icon-shape icon-shape-sm bg-danger bg-opacity-10 text-danger rounded-circle me-3">
                        <i class="bi bi-cart3 fs-5"></i>
                    </div>
                    <div>
                        <h6 class="text-muted mb-0">{% trans "Total Expenses" %} {% if is_current_year %}(YTD){% endif %}</h6>
                    </div>
                </div>
                <h3 class="fw-bold mb-0">
                    {{ user.profile.currency }}{{ total_expense_ytd|floatformat:0|translate_digits }}
                </h3>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
         <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="icon-shape icon-shape-sm bg-info bg-opacity-10 text-info rounded-circle me-3">
                        <i class="bi bi-piggy-bank fs-5"></i>
                    </div>
                    <div>
                        <h6 class="text-muted mb-0">{% trans "Avg. Balance Rate" %} {% if is_current_year %}(YTD){% endif %}</h6>
                    </div>
                </div>
                <h3 class="fw-bold mb-0">
                    {{ avg_balance_rate|translate_digits }}%
                </h3>
                 <small class="text-muted">{% trans "Percentage of income kept as balance/savings" %}</small>
            </div>
        </div>
    </div>
</div>

<!-- Charts Row -->
<div class="row g-4 mb-4 animate__animated animate__fadeInUp" style="animation-delay: 0.1s;">
    <!-- Line Chart -->
    <div class="col-lg-8">
        <div class="card border-0 shadow-lg h-100">
            <div class="card-header bg-transparent border-bottom py-3 d-flex justify-content-between align-items-center">
                <h5 class="fw-bold mb-0">{% trans "Income vs Expenses" %}</h5>
                <span class="text-muted" data-bs-toggle="tooltip" title="{% trans 'Green bars show what you earned, Red bars show what you spent. The Blue line is your Net Savings.' %}">
                    <i class="bi bi-question-circle"></i>
                </span>
            </div>
            <div class="card-body">
                <div style="height: 350px;">
                    <canvas id="balanceChart"></canvas>
                </div>
                 <div class="mt-3 text-center">
                    <small class="text-muted">
                        <i class="bi bi-info-circle me-1"></i> 
                        {% trans "Comparing what comes in (Green) vs. what goes out (Red). The gap is your potential savings." %}
                    </small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Donut Chart -->
    <div class="col-lg-4">
        <div class="card border-0 shadow-lg h-100">
            <div class="card-header bg-transparent border-bottom py-3 d-flex justify-content-between align-items-center">
                <h5 class="fw-bold mb-0">{% trans "Spending" %} ({{ selected_year }})</h5>
                 <span class="text-muted" data-bs-toggle="tooltip" title="{% trans 'Breakdown of where your money went this year. The biggest slice is your biggest expense category.' %}">
                    <i class="bi bi-question-circle"></i>
                </span>
            </div>
            <div class="card-body d-flex flex-column align-items-center justify-content-center position-relative">
                <div style="height: 300px; width: 100%;">
                    <canvas id="categoryDonutChart"></canvas>
                </div>
                 <div class="mt-3 text-center">
                    <small class="text-muted">
                        <i class="bi bi-info-circle me-1"></i> 
                        {% trans "See which categories are consuming the most of your budget this year." %}
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Balance Rate Trend -->
<div class="row animate__animated animate__fadeInUp" style="animation-delay: 0.2s;">
    <div class="col-12">
        <div class="card border-0 shadow-lg">
             <div class="card-header bg-transparent border-bottom py-3">
                <h5 class="fw-bold mb-0">{% trans "Balance Rate Trend (%)" %}</h5>
            </div>
            <div class="card-body">
                 <div style="height: 300px;">
                    <canvas id="rateChart"></canvas>
                </div>
                <div class="mt-3 text-center">
                    <small class="text-muted">
                        <i class="bi bi-info-circle me-1"></i> 
                        {% trans "Shows what % of your income is left after expenses. A higher positive percentage means you're growing your wealth." %}
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Sankey Diagram Section -->
<div class="row animate__animated animate__fadeInUp mt-4" style="animation-delay: 0.25s;">
    <div class="col-12">
        <div class="card border-0 shadow-lg mb-4">
            <div class="card-header bg-transparent border-bottom py-3 d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center gap-2">
                    <h5 class="fw-bold mb-0">{% trans "Income Flow" %}</h5>
                     <span class="text-muted" data-bs-toggle="tooltip" title="{% trans 'Visualizes how your income is distributed across your expenses and savings.' %}">
                        <i class="bi bi-question-circle"></i>
                    </span>
                </div>
            </div>
            <div class="card-body" style="overflow-x: auto;">
                 <div id="sankey_basic" style="width: 100%; min-width: 600px; height: 400px;"></div>
                <div class="mt-3 text-center">
                    <small class="text-muted">
                        <i class="bi bi-info-circle me-1"></i> 
                        {% trans "Watch your money flow from income to different categories." %}
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Cashflow Forecast Section (New) -->
{% if is_current_year %}
<div class="row animate__animated animate__fadeInUp mt-4" style="animation-delay: 0.3s;">
    <div class="col-12">
        <div class="card border-0 shadow-lg mb-4">
            <div class="card-header bg-transparent border-bottom py-3 d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center gap-2">
                    <h5 class="fw-bold mb-0">{% trans "Cashflow Forecast" %}</h5>
                     <span class="text-muted" data-bs-toggle="tooltip" title="{% trans 'Projected based on your 3-month average + active recurring bills. See if you will save or overspend in future months.' %}">
                        <i class="bi bi-question-circle"></i>
                    </span>
                </div>
                <span class="badge bg-info bg-opacity-10 text-info rounded-pill">{% trans "Next 6 Months" %}</span>
            </div>
            <div class="card-body">
                 <div style="height: 350px;">
                    <canvas id="forecastChart"></canvas>
                </div>
                <div class="mt-3 text-center">
                    <small class="text-muted">
                        <i class="bi bi-info-circle me-1"></i> 
                        {% trans "Projections based on your last 3 months average and active recurring transactions." %}
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Data Passing -->
{{ chart_labels|json_script:"chart-labels" }}
{{ income_data|json_script:"income-data" }}
{{ expense_data|json_script:"expense-data" }}
{{ balance_rate_data|json_script:"balance-rate-data" }}
{{ cat_labels|json_script:"cat-labels" }}
{{ cat_data|json_script:"cat-data" }}
{{ forecast_labels|json_script:"forecast-labels" }}
{{ forecast_income|json_script:"forecast-income" }}
{{ forecast_expenses|json_script:"forecast-expense" }}
{{ forecast_net|json_script:"forecast-net" }}
{{ sankey_data|json_script:"sankey-data" }}

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
  google.charts.load("current", {packages:["sankey"]});
  google.charts.setOnLoadCallback(drawSankeyChart);
  function drawSankeyChart() {
    const rawSankeyData = JSON.parse(document.getElementById('sankey-data').textContent);
    
    if (!rawSankeyData || rawSankeyData.length === 0) {
        document.getElementById('sankey_basic').innerHTML = '<p class="text-center text-muted mt-5" style="padding-top: 150px;">{% trans "Not enough data to map flow." %}</p>';
        return;
    }

    var data = new google.visualization.DataTable();
    data.addColumn('string', 'From');
    data.addColumn('string', 'To');
    data.addColumn('number', 'Amount');
    data.addRows(rawSankeyData);

    const isDark = document.documentElement.getAttribute('data-bs-theme') === 'dark';
    const textColor = isDark ? '#adb5bd' : '#6c757d';

    var options = {
      sankey: {
        node: {
          label: { color: textColor, fontName: 'Outfit', fontSize: 13, bold: true },
          nodePadding: 30,
          colors: ['#4bc0c0', '#36a2eb', '#ff6384', '#ffce56', '#9966ff', '#ff9f40', '#0dcaf0', '#2196f3', '#6610f2', '#e7e9ed']
        },
        link: {
          colorMode: 'gradient',
          colors: ['#4bc0c0', '#36a2eb', '#ff6384', '#ffce56', '#9966ff', '#ff9f40', '#0dcaf0', '#2196f3', '#6610f2', '#e7e9ed']
        }
      }
    };

    var chart = new google.visualization.Sankey(document.getElementById('sankey_basic'));
    chart.draw(data, options);
  }

  // Redraw chart on window resize for responsiveness
  window.addEventListener('resize', function() {
      const container = document.getElementById('sankey_basic');
      if (container && container.innerHTML !== '') {
          drawSankeyChart();
      }
  });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const labels = JSON.parse(document.getElementById('chart-labels').textContent);
        const incomeData = JSON.parse(document.getElementById('income-data').textContent);
        const expenseData = JSON.parse(document.getElementById('expense-data').textContent);
        const rateData = JSON.parse(document.getElementById('balance-rate-data').textContent);
        const catLabels = JSON.parse(document.getElementById('cat-labels').textContent);
        const catData = JSON.parse(document.getElementById('cat-data').textContent);

        // --- Common Config ---
        Chart.defaults.font.family = "'Outfit', sans-serif";
        const isDark = document.documentElement.getAttribute('data-bs-theme') === 'dark';
        Chart.defaults.color = isDark ? '#adb5bd' : '#6c757d';
        const gridColor = isDark ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.05)';


        // --- Custom Plugin to Draw Values on Charts ---
        const drawValuesPlugin = {
            id: 'drawValues',
            afterDatasetsDraw(chart, args, options) {
                const { ctx } = chart;
                ctx.save();
                
                chart.data.datasets.forEach((dataset, i) => {
                    const meta = chart.getDatasetMeta(i);
                    if (meta.hidden) return;

                    meta.data.forEach((element, index) => {
                        // Skip if value is 0 or null to avoid clutter
                        const value = dataset.data[index];
                        if (value === 0 || value === null) return;

                        let text = value.toString();
                        // Formatting
                        if (chart.config.type === 'line' || dataset.label.includes('Rate')) {
                             text += '%';
                        } else {
                             // Currency for others (approx) - can just show number
                             text = value.toLocaleString(); 
                        }
                        text = translateDigits(text);

                        ctx.font = 'bold 10px "Outfit", sans-serif';
                        ctx.fillStyle = isDark ? '#adb5bd' : '#6c757d';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'bottom';

                        // Position check
                        let x = element.x;
                        let y = element.y - 5; // shift up

                        // For Bar chart, if value is negative or small, adjust (assuming positive here mostly)
                        ctx.fillText(text, x, y);
                    });
                });
                ctx.restore();
            }
        };

        // 1. Balance Chart (Line/Bar Combo)
        const ctxBalance = document.getElementById('balanceChart').getContext('2d');
        new Chart(ctxBalance, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: '{% trans "Income" %}',
                        data: incomeData,
                        backgroundColor: 'rgba(75, 192, 192, 0.2)', // Green fill
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1,
                        borderRadius: 4,
                        order: 2
                    },
                    {
                        label: '{% trans "Expense" %}',
                        data: expenseData,
                        backgroundColor: 'rgba(255, 99, 132, 0.2)', // Red fill
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1,
                        borderRadius: 4,
                        order: 3
                    },
                    {
                        type: 'line',
                        label: '{% trans "Net Balance" %}',
                        data: incomeData.map((inc, i) => inc - expenseData[i]),
                        borderColor: '#2196f3', // Blue line
                        borderWidth: 2,
                        tension: 0.4,
                        pointRadius: 3,
                        fill: false,
                        order: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'top' },
                    tooltip: { mode: 'index', intersect: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                         grid: { color: gridColor }
                    },
                    x: {
                         grid: { display: false }
                    }
                }
            }
        });

        // 2. Spending Donut
        const ctxDonut = document.getElementById('categoryDonutChart').getContext('2d');
        // Generate nice colors (matching other charts)
        const bgColors = [
            'rgba(54, 162, 235, 0.8)',   // Blue
            'rgba(255, 99, 132, 0.8)',   // Red
            'rgba(255, 206, 86, 0.8)',   // Yellow
            'rgba(75, 192, 192, 0.8)',   // Teal
            'rgba(153, 102, 255, 0.8)',  // Purple
            'rgba(255, 159, 64, 0.8)',   // Orange
            'rgba(231, 233, 237, 0.8)'   // Grey
        ];
        
        // Enhance labels with values and percentages for the Legend
        const totalSpending = catData.reduce((acc, curr) => acc + curr, 0);
        const donutLabelsWithValues = catLabels.map((label, i) => {
            const val = catData[i];
            const percent = totalSpending > 0 ? ((val / totalSpending) * 100).toFixed(1) + '%' : '0%';
            return `${label} (${translateDigits(val.toLocaleString())} | ${translateDigits(percent)})`;
        });
        
        // --- Custom Plugin for Donut Percentages ---
        const drawDonutValuesPlugin = {
            id: 'drawDonutValues',
            afterDatasetsDraw(chart, args, options) {
                const { ctx } = chart;
                ctx.save();
                
                chart.data.datasets.forEach((dataset, i) => {
                    const meta = chart.getDatasetMeta(i);
                    if (meta.hidden) return;
                    
                    const total = dataset.data.reduce((acc, curr) => acc + curr, 0);

                    meta.data.forEach((element, index) => {
                         const value = dataset.data[index];
                         if (value === 0 || total === 0) return;
                         
                         const percentage = (value / total);
                         // Only show text if slice is > 5% to avoid overlap
                         if (percentage < 0.05) return;
                         
                         const text = translateDigits((percentage * 100).toFixed(0)) + '%';
                         
                         // Calculate position (centroid of arc)
                         const { x, y } = element.tooltipPosition();

                         ctx.font = 'bold 11px "Outfit", sans-serif';
                         ctx.fillStyle = '#fff'; 
                         ctx.textAlign = 'center';
                         ctx.textBaseline = 'middle';
                         
                         // Shadow for readability on light/similar colors
                         ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                         ctx.shadowBlur = 3;
                         
                         ctx.fillText(text, x, y);
                         
                         ctx.shadowColor = 'transparent';
                    });
                });
                ctx.restore();
            }
        };
        
        new Chart(ctxDonut, {
            type: 'doughnut',
            data: {
                labels: donutLabelsWithValues,
                datasets: [{
                    data: catData,
                    backgroundColor: bgColors.slice(0, catLabels.length),
                    borderWidth: 0,
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: {
                    legend: { position: 'bottom', labels: { boxWidth: 10 } }
                }
            },
            plugins: [drawDonutValuesPlugin]
        });
        
        // 3. Rate Chart (Line)
        const ctxRate = document.getElementById('rateChart').getContext('2d');
        const gradientRate = ctxRate.createLinearGradient(0, 0, 0, 400);
        gradientRate.addColorStop(0, 'rgba(13, 202, 240, 0.5)'); // Info color
        gradientRate.addColorStop(1, 'rgba(13, 202, 240, 0.0)');

        new Chart(ctxRate, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: '{% trans "Balance Rate (%)" %}',
                    data: rateData,
                    borderColor: '#0dcaf0',
                    backgroundColor: gradientRate,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 4,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#0dcaf0',
                    pointHoverRadius: 6
                }]
            },
             options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: { 
                        callbacks: {
                            label: function(context) {
                                 return translateDigits(context.parsed.y) + '%';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100, // Usually percentage doesn't go above 100 unless weird
                        grid: { color: gridColor },
                        ticks: { display: false } // Hide Y axis labels
                    },
                    x: {
                         grid: { display: false }
                    }
                }
            },
            plugins: [drawValuesPlugin]
        });

        // ---------------------------------------------------------
        // 4. Cashflow Forecast Chart (Mixed: Bar + Line)
        // ---------------------------------------------------------
        const forecastLabels = JSON.parse(document.getElementById('forecast-labels').textContent);
        const forecastIncome = JSON.parse(document.getElementById('forecast-income').textContent);
        const forecastExpense = JSON.parse(document.getElementById('forecast-expense').textContent);
        const forecastNet = JSON.parse(document.getElementById('forecast-net').textContent);

        const ctxForecast = document.getElementById('forecastChart').getContext('2d');
        
        new Chart(ctxForecast, {
            type: 'bar',
            data: {
                labels: forecastLabels,
                datasets: [
                    {
                        label: '{% trans "Projected Income" %}',
                        data: forecastIncome,
                        backgroundColor: 'rgba(75, 192, 192, 0.2)', 
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1,
                        borderRadius: 4,
                        order: 2
                    },
                    {
                        label: '{% trans "Projected Expense" %}',
                        data: forecastExpense,
                        backgroundColor: 'rgba(255, 99, 132, 0.2)', 
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1,
                        borderRadius: 4,
                        order: 3
                    },
                    {
                        type: 'line',
                        label: '{% trans "Projected Net Savings" %}',
                        data: forecastNet,
                        borderColor: '#6610f2', // Indigo/Purple
                        borderWidth: 2,
                        tension: 0.4,
                        pointRadius: 4,
                        fill: false,
                        order: 1,
                        borderDash: [5, 5] // Dashed line to indicate projection
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'top' },
                    tooltip: { mode: 'index', intersect: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: gridColor },
                        ticks: {
                            callback: function(value) {
                                return translateDigits(value.toLocaleString());
                            }
                        }
                    },
                    x: {
                         grid: { display: false }
                    }
                }
            },
            plugins: [drawValuesPlugin] // Re-use the value drawer
        });

        // Init Tooltips (Added for Contextual Help)
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        })

    });
</script>

</style>
{% else %}
    <!-- Locked Content State -->
    <div class="row align-items-center justify-content-center animate__animated animate__fadeIn" style="min-height: 60vh;">
        <div class="col-md-8 text-center">
             <div class="mb-4">
                <div class="feature-icon-box bg-warning bg-opacity-10 text-warning mx-auto mb-4" style="width: 100px; height: 100px; font-size: 3rem; display: flex; align-items: center; justify-content: center; border-radius: 50%;">
                    <i class="bi bi-lock-fill"></i>
                </div>
                <h1 class="fw-bold mb-3">{% trans "Analytics is a Pro Feature" %}</h1>
                <p class="lead text-muted mb-4">
                    {% trans "Unlock detailed insights, cashflow forecasting, and monthly trends with a Pro subscription." %}
                </p>
                <div class="d-grid gap-3 d-sm-flex justify-content-sm-center">
                    <button type="button" class="btn btn-primary btn-lg rounded-pill px-5 shadow-sm" data-bs-toggle="modal" data-bs-target="#comparePlansModal">
                        {% trans "Upgrade to Pro" %}
                    </button>
                    <a href="{% url 'home' %}" class="btn btn-outline-secondary btn-lg rounded-pill px-5">
                        {% trans "Go Back" %}
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Include the Compare Plans Modal -->
    {% include "components/compare_plans_modal.html" %}

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Init Tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
              return new bootstrap.Tooltip(tooltipTriggerEl)
            })

            var myModal = new bootstrap.Modal(document.getElementById('comparePlansModal'), {
                backdrop: 'static',
                keyboard: false
            });
            myModal.show();
        });
    </script>
{% endif %}
{% endblock %}
